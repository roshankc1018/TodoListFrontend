/**-----------------------------------------------------------------------------------------
* Copyright Â© 2021 Progress Software Corporation. All rights reserved.
* Licensed under commercial license. See LICENSE.md in the project root for more information
*-------------------------------------------------------------------------------------------*/
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { isEqual } from '@progress/kendo-date-math';
import { last, sortDates } from '../../util';
import { BusViewService } from './bus-view.service';
/**
 * @hidden
 */
var SelectionService = /** @class */ (function () {
    function SelectionService(bus) {
        this.bus = bus;
    }
    SelectionService.prototype.performSelection = function (args) {
        var date = args.date, modifiers = args.modifiers, selectionMode = args.selectionMode, activeViewEnum = args.activeViewEnum, rangePivot = args.rangePivot;
        var selectedDates = args.selectedDates.slice();
        if (selectionMode === 'multiple') {
            if (modifiers.ctrlKey || modifiers.metaKey) {
                if (this.isDateSelected(selectedDates, date)) {
                    selectedDates = selectedDates.filter(function (item) { return !isEqual(item, date); });
                }
                else {
                    selectedDates.push(date);
                }
                rangePivot = date;
            }
            else if (modifiers.shiftKey) {
                var _a = sortDates([rangePivot || date, date]), start = _a[0], end = _a[1];
                selectedDates = this.bus.service(activeViewEnum).dateRange(start, end);
                rangePivot = date > selectedDates[0] ? selectedDates[0] : last(selectedDates);
            }
            else {
                selectedDates = [date];
                rangePivot = date;
            }
        }
        else {
            selectedDates = [date];
            rangePivot = date;
        }
        return { selectedDates: selectedDates, rangePivot: rangePivot };
    };
    SelectionService.prototype.isDateSelected = function (selectedDates, date) {
        return selectedDates.some(function (item) { return isEqual(item, date); });
    };
    SelectionService = tslib_1.__decorate([
        Injectable(),
        tslib_1.__metadata("design:paramtypes", [BusViewService])
    ], SelectionService);
    return SelectionService;
}());
export { SelectionService };
